# https://doc.beegfs.io/7.2.10/trouble_shooting/general.html#solution-a
# If solution A does not work, do solution B and delete all storage directories
# https://doc.beegfs.io/7.2.10/trouble_shooting/general.html#solution-b
# $ beegfs-ctl --listtargets --longnodes
# $ beegfs-ctl --removetarget <targetID>

- name: Stop all BeeGFS instances (Solution A)
  hosts: coursemachines
  become: true
  become_user: root
  tasks:
    - name: stop mgmtd
      ansible.builtin.systemd_service:
        name: beegfs-mgmtd
        state: stopped
        enabled: true
    - name: stop medadata
      ansible.builtin.systemd_service:
        name: beegfs-meta
        state: stopped
        enabled: true
    - name: stop storage
      ansible.builtin.systemd_service:
        name: beegfs-storage
        state: stopped
        enabled: true
    - name: stop helperd
      ansible.builtin.systemd_service:
        name: beegfs-helperd
        state: stopped
        enabled: true
    - name: stop client
      ansible.builtin.systemd_service:
        name: beegfs-client
        state: stopped
        enabled: true

    - name: Remove storage directory mgmtd
      ansible.builtin.file:
        path: /etc/beegfs/beegfs-mgmtd.conf

    - name: Remove storage directory meta
      ansible.builtin.file:
        path: /etc/beegfs/beegfs-meta.conf

    - name: Remove storage directory storage
      ansible.builtin.file:
        path: /etc/beegfs/beegfs-storage.conf
    
